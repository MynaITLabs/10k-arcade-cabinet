game.snake=function(){function t(t,i){return Math.floor(Math.random()*(i-t+1)+t)}function i(){u=0,l.x=(a/2|0)*n,l.y=(o/2|0)*n,l.body.length=0,l.length=h,l.dx=1,l.dy=0,l.alive=!0,v.spawn()}for(var e=kontra.canvas.width,s=kontra.canvas.height,h=5,n=10,o=s/n,a=e/n,d=[],r=[],f=0;f<a*o;f++)r.push(f);var l=kontra.sprite({color:"#fff",body:[],length:h,move:function(){if(this.moved=!0,this.x+=this.dx*n,this.y+=this.dy*n,this.x<0||this.x>=kontra.canvas.width||this.y<0||this.y>=kontra.canvas.height)return void(this.alive=!1);var t=this.y/n*a+this.x/n;return this.body.indexOf(t)!==-1?void(this.alive=!1):(this.body.unshift(t),r.splice(r.indexOf(t),1),this.body.length>this.length&&r.push(this.body.pop()),void(this.x===v.x&&this.y===v.y&&(this.length+=5,v.spawn())))},update:function(t){if(this.alive)if(this.moved=!1,d.length){for(var i=0;i<d.length;i++){var e=d[i];"up"===e&&1!==this.dy?(this.dx=0,this.dy=-1,this.move()):"right"===e&&this.dx!==-1?(this.dx=1,this.dy=0,this.move()):"down"===e&&this.dy!==-1?(this.dx=0,this.dy=1,this.move()):"left"===e&&1!==this.dx&&(this.dx=-1,this.dy=0,this.move())}this.moved||this.move(),d.length=0}else this.move()},render:function(){this.context.fillStyle=this.color;for(var t=0;t<this.body.length;t++){var i=this.body[t]%a*n,e=(this.body[t]/a|0)*n;this.context.fillRect(i,e,n,n)}}}),v=kontra.sprite({spawn:function(){var i=t(0,r.length);this.x=r[i]%a*n,this.y=(r[i]/a|0)*n,this.alive=!0},render:function(){this.alive&&(kontra.context.beginPath(),kontra.context.arc(this.x+n/2,this.y+n/2,n/2,0,2*Math.PI),kontra.context.fill())}});i();var u=0,g=kontra.gameLoop({update:function(t){u+=t,game.updateKeys(),game.escPressed&&(g.stop(),game.goBack(),setTimeout(function(){i()},100)),game.enterPressed&&!l.alive&&i(),l.alive&&(game.upPressed?d.indexOf("up")===-1&&d.push("up"):game.rightPressed?d.indexOf("right")===-1&&d.push("right"):game.downPressed?d.indexOf("down")===-1&&d.push("down"):game.leftPressed&&d.indexOf("left")===-1&&d.push("left"),u>1/15&&(l.update(),u-=1/15))},render:function(){l.render(),v.render()},fps:30});return g}();